var w=Object.defineProperty;var u=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var _=(e,a,t)=>a in e?w(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,d=(e,a)=>{for(var t in a||(a={}))k.call(a,t)&&_(e,t,a[t]);if(u)for(var t of u(a))b.call(a,t)&&_(e,t,a[t]);return e};import{_ as l,c as p,s as y}from"./bi.519.0.js";import{u as M}from"./bi.457.443.js";const D=(e,a,t,o,c,n,r,i,h)=>{let s=d({},a);if(r){const g=d({},i);g[e.target.name]="",h(d({},g))}switch(s[e.target.name]=e.target.value,e.target.name==="id"&&I(s,t,c,n),e.target.name){case"spreadsheetId":s=spreadSheetChange(s,o,t,c,n);break;case"worksheetName":s=worksheetChange(s,o,t,c,n);break}t(d({},s))},v=(e,a,t,o,c)=>{o(!0);const n={formID:e,clientId:a.clientId,accessToken:a.tokenDetails.access_token,clientSecret:a.clientSecret,refreshToken:a.tokenDetails.refresh_token,tokenDetails:a.tokenDetails};p(n,"zoom_fetch_all_meetings").then(r=>{if(r&&r.success){const i=d({},a);i.default||(i.default={}),r.data.allMeeting&&(i.default.allMeeting=r.data.allMeeting),c({show:!0,msg:l("Meeting list refreshed","bit-integrations")}),t(d({},i))}else r&&r.data&&r.data.data||!r.success&&typeof r.data=="string"?c({show:!0,msg:y(l("All Meeting list refresh failed Cause: %s. please try again","bit-integrations"),r.data.data||r.data)}):c({show:!0,msg:l("All Meeting list failed. please try again","bit-integrations")});o(!1)}).catch(()=>o(!1))},I=(e,a,t,o)=>{t(!0);const c={meetingId:e.id,clientId:e.clientId,accessToken:e.tokenDetails.access_token,clientSecret:e.clientSecret,refreshToken:e.tokenDetails.refresh_token,tokenDetails:e.tokenDetails};p(c,"zoom_fetch_all_fields").then(n=>{t(!1),n&&n.success&&(a(r=>M(r,i=>{i.zoomFields=n.data,i.field_map=F(i.zoomFields)})),o({show:!0,msg:l("Zoom fields refreshed","bit-integrations")})),o({show:!0,msg:n!=null&&n.data?n==null?void 0:n.data:l("Zoom fields refreshed failed!","bit-integrations")})}).catch(()=>t(!1))},q=(e,a,t,o,c,n)=>{if(!e.clientId||!e.clientSecret){t({clientId:e.clientId?"":l("Client Id can't be empty","bit-integrations"),clientSecret:e.clientSecret?"":l("Secret key can't be empty","bit-integrations")});return}c(!0);const r=`https://zoom.us/oauth/authorize?response_type=code&client_id=${e.clientId}&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(`${btcbi.api.base}/redirect`)}`,i=window.open(r,"zoom","width=400,height=609,toolbar=off"),h=setInterval(()=>{if(i.closed){clearInterval(h);let s={},g=!1;const m=localStorage.getItem("__zoom");if(m&&(g=!0,s=JSON.parse(m),localStorage.removeItem("__zoom")),!s.code||s.error||!s||!g){const f=s.error?`Cause: ${s.error}`:"";n({show:!0,msg:`${l("Authorization failed","bit-integrations")} ${f}. ${l("please try again","bit-integrations")}`}),c(!1)}else{const f=d({},e);f.accountServer=s["accounts-server"],$(s,f,a,o,c,n)}}},500)},$=(e,a,t,o,c,n)=>{const r=d({},e);r.clientId=a.clientId,r.clientSecret=a.clientSecret,r.redirectURI=`${btcbi.api.base}/redirect`,p(r,"zoom_generate_token").then(i=>i).then(i=>{if(i&&i.success){const h=d({},a);h.tokenDetails=i.data,t(h),o(!0),n({show:!0,msg:l("Authorized Successfully","bit-integrations")})}else i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?n({show:!0,msg:`${l("Authorization failed Cause:","bit-integrations")}${i.data.data||i.data}. ${l("please try again","bit-integrations")}`}):n({show:!0,msg:l("Authorization failed. please try again","bit-integrations")});c(!1)})},z=e=>!((e.field_map?e.field_map.filter(t=>!t.formField&&!t.zoomConf):[]).length>0),F=(e=[])=>{const a=e==null?void 0:e.filter(t=>t.required===!0);return a.length>0?a.map(t=>({formField:"",zoomField:t.key})):[{formField:"",zoomField:""}]};export{q as a,z as c,D as h,I as r,v as z};
