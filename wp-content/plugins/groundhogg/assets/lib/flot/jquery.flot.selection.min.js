!function($){$.plot.plugins.push({init:function(e){var t={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},o={},n=null;function i(o){t.active&&(u(o),e.getPlaceholder().trigger("plotselecting",[r()]))}function s(i){1==i.which&&(document.body.focus(),void 0!==document.onselectstart&&null==o.onselectstart&&(o.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==o.ondrag&&(o.ondrag=document.ondrag,document.ondrag=function(){return!1}),a(t.first,i),t.active=!0,n=function(i){!function(i){n=null,void 0!==document.onselectstart&&(document.onselectstart=o.onselectstart),void 0!==document.ondrag&&(document.ondrag=o.ondrag),t.active=!1,u(i),g()?c():(e.getPlaceholder().trigger("plotunselected",[]),e.getPlaceholder().trigger("plotselecting",[null]))}(i)},$(document).one("mouseup",n))}function r(){if(!g())return null;if(!t.show)return null;var o={},n=t.first,i=t.second;return $.each(e.getAxes(),function(e,t){if(t.used){var s=t.c2p(n[t.direction]),r=t.c2p(i[t.direction]);o[e]={from:Math.min(s,r),to:Math.max(s,r)}}}),o}function c(){var t=r();e.getPlaceholder().trigger("plotselected",[t]),t.xaxis&&t.yaxis&&e.getPlaceholder().trigger("selected",[{x1:t.xaxis.from,y1:t.yaxis.from,x2:t.xaxis.to,y2:t.yaxis.to}])}function l(e,t,o){return t<e?e:t>o?o:t}function a(o,n){var i=e.getOptions(),s=e.getPlaceholder().offset(),r=e.getPlotOffset();o.x=l(0,n.pageX-s.left-r.left,e.width()),o.y=l(0,n.pageY-s.top-r.top,e.height()),"y"==i.selection.mode&&(o.x=o==t.first?0:e.width()),"x"==i.selection.mode&&(o.y=o==t.first?0:e.height())}function u(o){null!=o.pageX&&(a(t.second,o),g()?(t.show=!0,e.triggerRedrawOverlay()):d(!0))}function d(o){t.show&&(t.show=!1,e.triggerRedrawOverlay(),o||e.getPlaceholder().trigger("plotunselected",[]))}function f(t,o){var n,i,s,r,c=e.getAxes();for(var l in c)if((n=c[l]).direction==o&&(t[r=o+n.n+"axis"]||1!=n.n||(r=o+"axis"),t[r])){i=t[r].from,s=t[r].to;break}if(t[r]||(n="x"==o?e.getXAxes()[0]:e.getYAxes()[0],i=t[o+"1"],s=t[o+"2"]),null!=i&&null!=s&&i>s){var a=i;i=s,s=a}return{from:i,to:s,axis:n}}function g(){var o=e.getOptions().selection.minSize;return Math.abs(t.second.x-t.first.x)>=o&&Math.abs(t.second.y-t.first.y)>=o}e.clearSelection=d,e.setSelection=function(o,n){var i,s=e.getOptions();"y"==s.selection.mode?(t.first.x=0,t.second.x=e.width()):(i=f(o,"x"),t.first.x=i.axis.p2c(i.from),t.second.x=i.axis.p2c(i.to)),"x"==s.selection.mode?(t.first.y=0,t.second.y=e.height()):(i=f(o,"y"),t.first.y=i.axis.p2c(i.from),t.second.y=i.axis.p2c(i.to)),t.show=!0,e.triggerRedrawOverlay(),!n&&g()&&c()},e.getSelection=r,e.hooks.bindEvents.push(function(e,t){null!=e.getOptions().selection.mode&&(t.mousemove(i),t.mousedown(s))}),e.hooks.drawOverlay.push(function(e,o){if(t.show&&g()){var n=e.getPlotOffset(),i=e.getOptions();o.save(),o.translate(n.left,n.top);var s=$.color.parse(i.selection.color);o.strokeStyle=s.scale("a",.8).toString(),o.lineWidth=1,o.lineJoin=i.selection.shape,o.fillStyle=s.scale("a",.4).toString();var r=Math.min(t.first.x,t.second.x)+.5,c=Math.min(t.first.y,t.second.y)+.5,l=Math.abs(t.second.x-t.first.x)-1,a=Math.abs(t.second.y-t.first.y)-1;o.fillRect(r,c,l,a),o.strokeRect(r,c,l,a),o.restore()}}),e.hooks.shutdown.push(function(e,t){t.unbind("mousemove",i),t.unbind("mousedown",s),n&&$(document).unbind("mouseup",n)})},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery);